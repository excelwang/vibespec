<!-- 
FILENAME FORMAT: YYYY-MM-DDTHHMM-distill-l2-l3.md 
-->

# Distill L2/L3 from Source (Late Binding)

## Context
The user explicitly requested: "L2, L3 content does not need to be generated immediately, postpone to distill from src". This shifts the workflow from "Spec-First" (for all layers) to "Spec-Guided" (L0/L1) followed by "Code-First" (Implementation) and finally "Spec-Distillation" (L2/L3 Reverse Engineering). This leverages the existing `VISION.VIBE_CODING.LATE_BINDING` principle.

## Proposal

### L0: Vision / Scope
- **Reaffirm**: `VISION.VIBE_CODING.LATE_BINDING` is now the primary mode for L2/L3.
- **Update**: `VISION.TRACEABILITY.WORKFLOW`: Explicitly allow "Code -> Spec" direction for lower layers.

### L1: Contracts (Rules)
- **New**: `CONTRACTS.EVOLUTION.CODE_FIRST`
  - Statement: "Agent MAY defer L2/L3 spec generation until implementation is stable."
  - Impact: `vibespec` refinement cycle stops at L1 for new features.
- **New**: `CONTRACTS.EVOLUTION.DISTILLATION`
  - Statement: "Agent MUST distill L2/L3 specs from source code before verifying feature completion."
  - Verification: `vibespec distill` command must be run.

### L2: Architecture (Components)
- **New Role**: `DOC_GENERATOR` (or `DISTILLER`)
  - Responsibility: Analyze source code AST/Signatures and generate L3 Interface/Algorithm specs.

### L3: Implementation (Details)
- **New Workflow**: `DISTILL_WORKFLOW`
  - Trigger: `vibespec distill`
  - Input: `src/` directory.
  - Output: Updated `specs/L3-RUNTIME/`.
  - Logic: 
    1. Scan `src/` for classes/functions.
    2. Map to L2 Components/Roles.
    3. Generate/Update L3 Spec items using `[Type: SCRIPT/INTERFACE]` format.

### SKILL.md
- **Update**: `vibespec` Refinement Cycle.
  - Step 3 (Refine): Loop L0 -> L1. **Stop**.
  - Instruction: "Hand off to Agent for Implementation."
- **New Trigger**: `vibespec distill`
  - Action: Reverse-engineer L3 specs from current `src/`.

## Rationale
- **Accuracy**: Specs generated *after* working code are 100% accurate to the implementation.
- **Velocity**: Reduces upfront friction of writing detailed specs for experimental features.
- **Alignment**: Fits the requested "Late Binding" philosophy.

## Verification Plan

### Automated Validation
- [ ] `validate.py` should NOT fail if L1 has no L3 children *during development* (needs "Draft" or "Pending" status support?).
  - *Correction*: `validate.py` currently enforces L1->L3 coverage. We might need to tag L1 items as `[Status: Pending]` to bypass this, or accept the warning during dev.
  - *Proposal*: Accept warnings during dev.

### Manual Review Criteria
- [ ] **Workflow**: Does `vibespec` stop asking for L3 specs?
- [ ] **Distillation**: Does `vibespec distill` successfully generate L3 file content from code?
