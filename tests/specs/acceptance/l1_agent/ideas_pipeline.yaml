spec_id: CONTRACTS.IDEAS_PIPELINE
type: agent_contract
description: "Agent contracts for processing ideas"

contracts:
  - id: LEVEL_SEEKING
    requirement: "Agent MUST classify each idea to highest applicable layer"
    cases:
      - name: "Classifies to highest layer"
        given:
          idea: "Add validation for user input"
        then:
          behavior: "Agent classifies to L1 (contract level)"
        evaluation: llm

  - id: DECOMPOSITION
    requirement: "Agent MUST split mixed-level ideas and process sequentially"
    cases:
      - name: "Splits mixed idea"
        given:
          idea: "Add vision for caching and implement cache interface"
        then:
          behavior: "Agent splits into L0 vision idea and L3 interface idea"
        evaluation: llm

  - id: APPROVAL_REQUIRED
    requirement: "Agent MUST pause for human review after creating idea file"
    cases:
      - name: "Pauses for approval"
        given:
          action: "Created new idea file"
        then:
          behavior: "Agent asks user for approval before proceeding"
        evaluation: llm

  - id: COMPILE_PROMPT
    requirement: "Agent SHOULD prompt for compilation when ideas/ is empty"
    cases:
      - name: "Prompts for compile"
        given:
          ideas_dir: "empty"
        then:
          behavior: "Agent suggests running compile"
        evaluation: llm

  - id: CONFLICT_RES
    requirement: "Agent MUST resolve conflicts by latest timestamp"
    cases:
      - name: "Uses latest"
        given:
          ideas:
            - timestamp: 1707300000
              value: "old"
            - timestamp: 1707400000
              value: "new"
        then:
          behavior: "Agent uses the newer value"
        evaluation: llm
