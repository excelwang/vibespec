spec_id: CONTRACTS.REJECTION_HANDLING
type: agent_contract
description: "Agent contracts for handling rejections and retries"

contracts:
  - id: AUTOMATED_RETRY
    requirement: "Agent MAY self-correct up to 3 times for fixable errors"
    cases:
      - name: "Retries on syntax error"
        given:
          error_type: "syntax"
          attempt: 1
        then:
          behavior: "Agent attempts to fix and retry"
        evaluation: llm

  - id: AUTOMATED_GIVEUP
    requirement: "Agent MUST revert and halt after 3 failed retries"
    cases:
      - name: "Gives up after 3"
        given:
          error_type: "syntax"
          attempt: 3
        then:
          behavior: "Agent reverts changes and stops"
        evaluation: llm

  - id: HUMAN_REJECTION
    requirement: "Agent MUST revert to pre-task state on user rejection"
    cases:
      - name: "Reverts on rejection"
        given:
          user_response: "reject"
        then:
          behavior: "Agent reverts all changes from task"
        evaluation: llm
