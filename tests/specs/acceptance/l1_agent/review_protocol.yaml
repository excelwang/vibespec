spec_id: CONTRACTS.REVIEW_PROTOCOL
type: agent_contract
description: "Agent review protocol for spec edits"

contracts:
  - id: SELF_AUDIT
    requirement: "Agent MUST read full layer content after revision"
    cases:
      - name: "Agent reads after edit"
        given:
          action: "Agent edited L1-CONTRACTS.md"
        then:
          behavior: "Agent calls view_file on L1-CONTRACTS.md"
        evaluation: llm

  - id: QUALITY_ALIGNMENT
    requirement: "Agent SHOULD verify TARGET_PROJECT pillar alignment"
    cases:
      - name: "Checks pillars"
        given:
          spec_tags: []
        then:
          behavior: "Agent warns about missing pillar tags"
        evaluation: llm

  - id: HIERARCHY_CHECK
    requirement: "Agent MUST load parent layer before editing child"
    cases:
      - name: "Loads parent first"
        given:
          target: "L2"
        then:
          behavior: "Agent reads L1 before editing L2"
        evaluation: llm

  - id: OMISSION_CHECK
    requirement: "Agent MUST verify all parent keys are represented in child"
    cases:
      - name: "Checks coverage"
        given:
          parent_keys: ["A", "B"]
          child_keys: ["A"]
        then:
          behavior: "Agent warns about missing B"
        evaluation: llm

  - id: REDUNDANCY
    requirement: "Agent MUST flag duplicate definitions"
    cases:
      - name: "Flags duplicates"
        given:
          items: ["A", "A"]
        then:
          behavior: "Agent warns about duplicate A"
        evaluation: llm

  - id: CONTRADICTION
    requirement: "Agent MUST flag conflicts with existing content"
    cases:
      - name: "Flags contradiction"
        given:
          existing: "MUST do X"
          new: "MUST NOT do X"
        then:
          behavior: "Agent errors on contradiction"
        evaluation: llm

  - id: NOTIFICATION
    requirement: "Agent MUST present all findings during approval"
    cases:
      - name: "Shows findings"
        given:
          findings: ["warning_1", "error_1"]
        then:
          behavior: "Agent shows all findings to user"
        evaluation: llm

  - id: SEQUENTIAL_ONLY
    requirement: "Agent MUST NOT edit multiple layers in one turn"
    cases:
      - name: "Single layer edit"
        given:
          edit_request: "Edit L1 and L2"
        then:
          behavior: "Agent edits only one layer per turn"
        evaluation: llm

  - id: SKILL_TRACEABILITY
    requirement: "Agent MUST NOT edit SKILL.md without updating L3"
    cases:
      - name: "L3 before SKILL"
        given:
          edit_request: "Update SKILL.md"
        then:
          behavior: "Agent updates L3 first"
        evaluation: llm
